<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: KoaApi.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: KoaApi.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>const debug = require('debug')('mh:KoaApi')
const koaRouter = require('@koa/router')
const { Exception } = require('@mhio/exception')
const {
  KoaApiHandle,
  KoaApiHandleException,
  // Dependencies
  Message,
  MessageData,
  MessageError,
  ApiResponse
} = require('@mhio/koa-api-handle')


class KoaApiException extends Exception {}

/** 
  Handle API requests and errors in Koa apps in a standard way. 
*/
class KoaApi {

  /**
   * Setup an array of routes
   * @param {object} app            - Koa app
   * @param {object} router         - @koa/router instance
   * @param {array} routes_config    - Array of KoaApiHandle route config objects
   * @returns {object} Koa-Router
   */
  static setupRoutes(routes_config, opts = {}){
    if (!routes_config || !routes_config.length) throw new KoaApiException('Setup requires an array of route configs')
    const router = opts.router || new koaRouter()
    const app = opts.app

    for (const route_config of routes_config){
      debug('Adding route', route_config)
      this.setupRoute(router, route_config)
    }

    if (app) {
      debug('Adding router to provided app')
      app.use(router.routes()).use(router.allowedMethods())
    }
    return router
  }

  /**
   * Setup a single route
   * @param {object} router                           - @koa/router instance
   * @param {object} route_config                     - route config object
   * @param {string} route_config.method              - HTTP method
   * @param {string} route_config.path                - HTTP Path
   * @param {function} route_config.fn                  - Handler function
   * @param {object} route_config.handler_object      - Object with handler function
   * @param {string} route_config.handler_function    - Method name to call in handler object
   * @returns {object} Koa-Router
   */
  static setupRoute(router, route_config = {}) {
    if (!router) throw new KoaApiException('Setup route requires a @koa/router')
    const { method, path, routes, fn, handler_object, handler_function } = route_config
    if (!path) throw new KoaApiException('Setup route requires  route path')
    if (routes) {
      const sub_router = this.setupRoutes(routes)
      router.use(path, sub_router.routes()).use(sub_router.allowedMethods())
      return sub_router
    }
    if (!method) throw new KoaApiException('Setup route requires a route method')
    if (!fn &amp;&amp; (!handler_object || !handler_function)) {
      throw new KoaApiException('Setup route requires routes, handler_ or fn')
    }
    if (fn &amp;&amp; (handler_object || handler_function)) {
      throw new KoaApiException('User either fn or handler_')
    }
    if (fn &amp;&amp; typeof fn !== 'function') {
      throw new KoaApiException('Setup route fn to be a function')
    }
    const handleFn = (fn)
      ? KoaApiHandle.response(fn)
      : KoaApiHandle.response(handler_object[handler_function].bind(handler_object))
    router[method](path, handleFn)
    return router
  }

  constructor(){
    throw new KoaApiException('No class instances for you!')
  }

}

module.exports = {
  KoaApi,
  KoaApiException,
  // Dependencies
  KoaApiHandle,
  KoaApiHandleException,
  Message,
  MessageData,
  MessageError,
  ApiResponse
}
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="KoaApi.html">KoaApi</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.5</a> on Thu Aug 13 2020 11:21:26 GMT+1000 (Australian Eastern Standard Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
